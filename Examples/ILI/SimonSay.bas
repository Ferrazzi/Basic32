10 SOUND = 1
20 BUZZER = 14
30 SCORE = 0
40 DIM SEQ(512)
50 PINMODE BUZZER OUTPUT NOPULL
60 ILI INIT 17 16 5 3
70 ILI LED 32 1
80 ILI INIT TOUCH 4 3
90 ILI CLEAR
100 IF TOUCH CALIBRATE = 0 THEN ILI TOUCH CALIBRATE
110 REM ==== MAIN MENU ====
120 ILI CLEAR
130 ILI SPRITE CLEAR
140 ILI FILLRECT 0 0 319 239 178 226 255
150 ILI RECT 32 120 256 32 255 0 0
160 ILI RECT 32 64 256 32 255 0 0
170 ILI SPRITE NEW 1 RECT 33 65 254 30 25 83 255
180 ILI SPRITE NEW 2 RECT 33 121 254 30 25 83 255
190 ILI SPRITE DRAW
200 ILI TEXT 90 16 3 "SIMON SAY" 255 0 0
210 ILI TEXT 104 73 2 "START GAME" 255 0 0
220 ILI TEXT 112 129 2 "SETTINGS" 255 0 0
230 ILI TOUCH SPRITE 1 GOTO 260DOWN DEBOUNCE 200
240 ILI TOUCH SPRITE 2 GOTO 1060DOWN DEBOUNCE 200
250 GOTO 230
260 REM ==== GAME SCREEN ====
270 SCORE = 0
280 ILI CLEAR
290 ILI SPRITE CLEAR
300 ILI FILLRECT 0 0 319 239 0 0 0
310 ILI SPRITE NEW 6 TEXT 80 10 3 "SCORE" 255 255 255
320 ILI SPRITE NEW 7 TEXT 200 10 3 STR$(SCORE) 255 255 0
330 ILI SPRITE DRAW
340 ILI SPRITE NEW 8 RECT 20 60 130 80 255 255 0
350 ILI SPRITE NEW 9 RECT 170 60 130 80 0 255 0
360 ILI SPRITE NEW 10 RECT 20 150 130 80 255 0 0
370 ILI SPRITE NEW 11 RECT 170 150 130 80 0 0 255
380 ILI SPRITE DRAW
390 REM ==== START GAME ====
400 LEVEL = 1
410 LE = 1
420 SEQ(1) = RND(1, 4)
430 IDX = 1
440 SPEED = 800
450 GOTO 600
460 REM ==== PLAYER INPUT LOOP ====
470 ILI TOUCH SPRITE ANY SET S DOWN
480 IF S = 0 THEN GOTO 470
490 C = 0
500 IF S = 8 THEN C = 1
510 IF S = 9 THEN C = 2
520 IF S = 10 THEN C = 3
530 IF S = 11 THEN C = 4
540 IF C = 0 THEN GOTO 470
550 GOSUB 890
560 IF C <> SEQ(IDX) THEN GOTO 840
570 IDX = IDX + 1
580 IF IDX <= LE THEN GOTO 470
590 GOTO 680
600 REM ==== SEQUENCE PLAYBACK ====
610 K = 1
620 IF K > LE THEN GOTO 810
630 C = SEQ(K)
640 GOSUB 890
650 WAIT 80
660 K = K + 1
670 GOTO 620
680 IF LEVEL > 12 THEN SPEED = 300
690 SCORE = SCORE + 1
700 ILI SPRITE SETTEXT 7 STR$(SCORE) 255 255 0
710 ILI SPRITE DRAW 7
720 REM ==== UPDATE SPEED PER LEVEL ====
730 LEVEL = LEVEL + 1
740 IF LEVEL <= 4 THEN SPEED = 800
750 IF LEVEL > 4 AND LEVEL <= 8 THEN SPEED = 600
760 IF LEVEL > 8 AND LEVEL <= 12 THEN SPEED = 400
770 IF LEVEL > 12 THEN SPEED = 300
780 IF LE < 512 THEN LE = LE + 1
790 SEQ(LE) = RND(1, 4)
800 GOTO 600
810 REM ==== READY FOR INPUT ====
820 IDX = 1
830 GOTO 470
840 REM ==== END GAME ====
850 IF SOUND = 1 THEN TONE BUZZER "F3" 400
860 ILI TEXT 70 120 3 "GAME OVER" 255 0 0
870 WAIT 1000
880 GOTO 110
890 REM ==== TONE ====
900 IF C = 1 THEN ILI FILLRECT 20 60 130 80 255 255 200
910 IF C = 2 THEN ILI FILLRECT 170 60 130 80 200 255 200
920 IF C = 3 THEN ILI FILLRECT 20 150 130 80 255 180 180
930 IF C = 4 THEN ILI FILLRECT 170 150 130 80 180 180 255
940 D = SPEED - 100
950 IF D < 100 THEN D = 100
960 IF SOUND = 1 AND C = 1 THEN TONE BUZZER "C5" D
970 IF SOUND = 1 AND C = 2 THEN TONE BUZZER "E5" D
980 IF SOUND = 1 AND C = 3 THEN TONE BUZZER "G5" D
990 IF SOUND = 1 AND C = 4 THEN TONE BUZZER "B5" D
1000 WAIT D
1010 IF C = 1 THEN ILI FILLRECT 20 60 130 80 255 255 0
1020 IF C = 2 THEN ILI FILLRECT 170 60 130 80 0 255 0
1030 IF C = 3 THEN ILI FILLRECT 20 150 130 80 255 0 0
1040 IF C = 4 THEN ILI FILLRECT 170 150 130 80 0 0 255
1050 RETURN
1060 REM ==== SETTINGS SCREEN ====
1070 ILI CLEAR
1080 ILI SPRITE CLEAR
1090 ILI FILLRECT 0 0 319 239 178 226 255
1100 ILI TEXT 88 16 3 "SETTINGS" 255 0 0
1110 ILI RECT 32 64 256 32 255 0 0
1120 ILI RECT 32 176 256 32 255 0 0
1130 ILI SPRITE NEW 4 RECT 33 65 254 30 25 83 255
1140 ILI SPRITE NEW 5 RECT 33 177 254 30 25 83 255
1150 ILI SPRITE NEW 6 TEXT 220 73 2 "ON" 255 0 0
1160 IF SOUND = 0 THEN ILI SPRITE SETTEXT 6 "OFF" 255 0 0 ELSE ILI SPRITE SETTEXT 6 "ON" 255 0 0
1170 ILI SPRITE DRAW
1180 ILI TEXT 72 73 2 "SOUND" 255 0 0
1190 ILI TEXT 140 185 2 "BACK" 255 0 0
1200 ILI TOUCH SPRITE 5 GOTO 110DOWN DEBOUNCE 200
1210 ILI TOUCH SPRITE 4 GOTO 1230DOWN DEBOUNCE 200
1220 GOTO 1180
1230 IF SOUND = 0 THEN SOUND = 1 ELSE SOUND = 0
1240 IF SOUND = 1 THEN TONE BUZZER "C5" 300: DELAY 320 : NOTONE 0
1250 IF SOUND = 0 THEN ILI SPRITE SETTEXT 6 "OFF" 255 0 0 ELSE ILI SPRITE SETTEXT 6 "ON" 255 0 0
1260 ILI SPRITE DRAW 6
1270 ILI SPRITE DRAW
1280 GOTO 1200
