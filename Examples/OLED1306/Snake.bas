10 REM ===== SNAKE ESP32 OLED 128X64 =====
20 OLED INIT 128 64 3C
30 OLED CLEAR
40 SPEED = 10
50 REM ==== BUTTON CONFIGURATION ====
60 LBTN = 12
70 RBTN = 11
80 UBTN = 10
90 DBTN = 13
100 PINMODE LBTN INPUT PULLUP DEBOUNCE 60
110 PINMODE RBTN INPUT PULLUP DEBOUNCE 60
120 PINMODE UBTN INPUT PULLUP DEBOUNCE 60
130 PINMODE DBTN INPUT PULLUP DEBOUNCE 60
140 REM ==== SPLASH SCREEN ====
150 OLED CLEAR
160 TITLE$ = "SNAKE"
170 MSG$ = "Press a button"
180 TW = LEN(TITLE$) * 6 * 2
190 TX = (128 - TW) / 2
200 OLED TEXT TX 14 2 TITLE$ WHITE 0
210 MW = LEN(MSG$) * 6 * 1
220 MX = (128 - MW) / 2
230 OLED TEXT MX 42 1 MSG$ WHITE 0
240 OLED DRAW
250 REM ==== WAIT FOR BUTTON PRESS (PULL-UP: PRESSED=0) ====
260 LB = DLEVEL(LBTN)
270 RB = DLEVEL(RBTN)
280 UB = DLEVEL(UBTN)
290 DB = DLEVEL(DBTN)
300 IF LB=1 AND RB=1 AND UB=1 AND DB=1 THEN GOTO 260
310 REM ==== PLAYFIELD SETTINGS ====
320 CELL = 4
330 OFFX = 2
340 OFFY = 12
350 GRIDW = 30
360 GRIDH = 12
370 GW = GRIDW * CELL
380 GH = GRIDH * CELL
390 REM ==== CLEAR SCREEN AND DRAW HUD ====
400 OLED CLEAR
410 OLED TEXT 0 0 1 "SCORE:" WHITE 0
420 SCORE = 0
430 GOSUB 1570
440 REM ==== OUTER BORDER OF THE PLAYFIELD ====
450 OLED RECT OFFX-1 OFFY-1 GW+2 GH+2 WHITE 0
460 OLED DRAW
470 REM ==== SNAKE DATA ====
480 MAXLEN = 120
490 DIM SX(MAXLEN)
500 DIM SY(MAXLEN)
510 REM ==== INITIAL SNAKE POSITION ====
520 SLEN = 3
530 HX = INT(GRIDW / 2)
540 HY = INT(GRIDH / 2)
550 LET SX(0) = HX : LET SY(0) = HY
560 LET SX(1) = HX - 1 : LET SY(1) = HY
570 LET SX(2) = HX - 2 : LET SY(2) = HY
580 REM ==== INITIAL DIRECTION ====
590 DX = 1 : DY = 0
600 REM ==== DRAW INITIAL SNAKE (BUFFERED) ====
610 FOR I = 0 TO SLEN - 1
620 GOSUB 1320
630 NEXT I
640 REM ==== FOOD ====
650 FOODNEW = 1
660 GOSUB 1420
670 OLED DRAW
680 REM ==== GAME LOOP ====
690 GAME = 1
700 IF GAME = 0 THEN GOTO 1230
710 REM ==== READ BUTTONS ====
720 LB = DLEVEL(LBTN)
730 RB = DLEVEL(RBTN)
740 UB = DLEVEL(UBTN)
750 DB = DLEVEL(DBTN)
760 REM ==== CHANGE DIRECTION (NO REVERSE) ====
770 IF LB = 0 AND DX <> 1 THEN DX = -1 : DY = 0
780 IF RB = 0 AND DX <> -1 THEN DX = 1 : DY = 0
790 IF UB = 0 AND DY <> 1 THEN DX = 0 : DY = -1
800 IF DB = 0 AND DY <> -1 THEN DX = 0 : DY = 1
810 REM ==== CALCULATE NEW HEAD POSITION ====
820 NHX = SX(0) + DX
830 NHY = SY(0) + DY
840 REM ==== WALL COLLISION ====
850 IF NHX < 0 THEN GAME = 0 : GOTO 1230
860 IF NHX >= GRIDW THEN GAME = 0 : GOTO 1230
870 IF NHY < 0 THEN GAME = 0 : GOTO 1230
880 IF NHY >= GRIDH THEN GAME = 0 : GOTO 1230
890 REM ==== BODY COLLISION ====
900 FOR I = 0 TO SLEN - 1
910 IF NHX = SX(I) AND NHY = SY(I) THEN GAME = 0 : GOTO 1230
920 NEXT I
930 REM ==== SAVE TAIL (CELL TO CLEAR) ====
940 TX = SX(SLEN - 1)
950 TY = SY(SLEN - 1)
960 REM ==== MOVE BODY ====
970 FOR I = SLEN - 1 TO 1 STEP -1
980 LET SX(I) = SX(I - 1)
990 LET SY(I) = SY(I - 1)
1000 NEXT I
1010 LET SX(0) = NHX
1020 LET SY(0) = NHY
1030 REM ==== FOOD CELL CHECK ====
1040 EAT = 0
1050 IF SX(0) = FX AND SY(0) = FY THEN EAT = 1
1060 IF EAT = 1 THEN SLEN = SLEN + 1
1070 IF EAT = 1 THEN LET SX(SLEN - 1) = TX
1080 IF EAT = 1 THEN LET SY(SLEN - 1) = TY
1090 IF EAT = 1 THEN SCORE = SCORE + 10
1100 IF EAT = 1 THEN GOSUB 1570
1110 IF EAT = 1 THEN GOSUB 1420
1120 REM ==== DRAW CHANGES ONLY (DIRTY CELLS) ====
1130 REM CLEAR OLD TAIL ONLY IF NOT EATEN
1140 IF EAT = 0 THEN GOSUB 1370ELSE A=0
1150 REM DRAW NEW HEAD
1160 I = 0 : GOSUB 1320
1170 REM KEEP FOOD VISIBLE (OPTIONAL REDRAW)
1180 GOSUB 1520
1190 REM ==== UPDATE ONLY PLAYFIELD AREA ====
1200 OLED DRAWRECT 0 0 128 64
1210 DELAY SPEED
1220 GOTO 700
1230 REM ===== GAME OVER =====
1240 OLED FILLRECT 0 0 128 64 BLACK 0
1250 GO$ = "GAME OVER"
1260 GW = LEN(GO$) * 6 * 1
1270 GX = (128 - GW) / 2
1280 OLED TEXT GX 28 1 GO$ WHITE 0
1290 OLED DRAW
1300 DELAY 2000
1310 GOTO 40
1320 REM ===== DRAW SNAKE SEGMENT I (FILLED CELL) =====
1330 PX = OFFX + SX(I) * CELL
1340 PY = OFFY + SY(I) * CELL
1350 OLED FILLRECT PX PY CELL CELL WHITE 0
1360 RETURN
1370 REM ===== CLEAR TAIL CELL (TX,TY) =====
1380 PX = OFFX + TX * CELL
1390 PY = OFFY + TY * CELL
1400 OLED FILLRECT PX PY CELL CELL BLACK 0
1410 RETURN
1420 REM ===== PLACE FOOD (AVOID SNAKE) =====
1430 OK = 0
1440 FX = RND(0, GRIDW)
1450 FY = RND(0, GRIDH)
1460 FOR I = 0 TO SLEN - 1
1470 IF FX = SX(I) AND FY = SY(I) THEN OK = 1
1480 NEXT I
1490 IF OK = 1 THEN OK = 0 : GOTO 1440
1500 GOSUB 1520
1510 RETURN
1520 REM ===== DRAW FOOD =====
1530 PX = OFFX + FX * CELL
1540 PY = OFFY + FY * CELL
1550 OLED FILLRECT PX PY CELL CELL WHITE 0
1560 RETURN
1570 REM ===== UPDATE SCORE HUD (SIMPLE) =====
1580 OLED FILLRECT 42 0 86 10 BLACK 0
1590 OLED TEXT 42 0 1 SCORE WHITE 0
1600 RETURN
